# syntax=docker/dockerfile:1

# Use a build argument to specify the base image tag
ARG BASE_IMAGE_TAG=latest
FROM byronthomas712/theta-vllm-llama-index:${BASE_IMAGE_TAG}
LABEL org.opencontainers.image.authors="byron@humane-it.com"
LABEL description="The runner / serving application of RAG App Studio"


# Set the working directory in the container
WORKDIR /app

# Copy all Python files from the build context, excluding those in the 'tests' directory
COPY --chown=root:root ./rag_studio/*.py /app/rag_studio/
COPY --chown=root:root ./rag_studio/openai/*.py /app/rag_studio/openai/
COPY --chown=root:root ./rag_studio/inference/*.py /app/rag_studio/inference/
COPY --chown=root:root ./rag_studio/runner_static /app/rag_studio/runner_static

ENV VLLM_DO_NOT_TRACK=1
ENV VLLM_CONFIGURE_LOGGING=0
ENTRYPOINT ["bash", "-c", "source ~/.profile && fastapi run rag_studio/inference_webserver.py"]
